---
layout: post
comments: true
categories: Spring, JPA

---

# JPA 영속성 관리

## 1. 영속성 컨텍스트 개념

- 영속성 컨텍스트 (Persistence Context)
  - 엔티티를 영구 저장하는 환경
  - 엔티티 매니저로 엔티티를 저장하거나 조회하면 엔티티 매니저는 영속성 컨텍스트에 엔티티를 보관하고 관리한다.
  - 영속성 컨텍스트는 엔티티 매니저를 생성할 때 하나 만들어 진다. 엔티티 매니저를 통하여 영속성 컨텍스트에 접근할 수 있고 관리 할 수 있다.

## 2. 엔티티의 생명주기

![](./../../assets/spring/jpa_persistance.PNG)

- 비영속(new/transient) : 영속성 컨텍스트와 전혀 관계가 없는 상태
- 영속(merged) : 영속성 컨텍스트에 저장된 상태
- 준영속(detached) : 영속성 컨텍스트에 저장되었다가 분리된 상태
- 삭제 (removed) : 삭제된 상태



### 3. 비영속

- 순수한 객체이며, 아직 영속성 컨텍스트와 연관이 없는 객체이다.



### 4. 영속

- Entity Manger를 통하여 엔티티를 영속성 컨텍스트에 저장했다.
- 영속성 컨텍스트가 관리하는 엔티티를 영속 상태라 한다.
- ORM을 사용하여 조회한 엔티티도 영속성 컨텍스트가 관리하는 영속 상태이다.

### 5. 준영속

- 영속성 컨텍스트과 관리하던 영속 상태의 엔티티를 영속성 컨텍스트가 관리하지 않으면 준영속 상태가 된다.
- session.close(), session.clear()를 통하여 준영속 상태로 만들 수 있다.

### 6. 삭제

- 엔티티를 영속성 컨텍스트와 데이터베이스에서 삭제한다.



## 3. 영속성 컨텍스트의 특징

- JPA는 보통 트랜잭션을 커밋하는 순간 영속성 컨텍스트에 새로 저장된 엔티티를 데이터베이스에 반영한다. 이 과정을 flush라 한다.
- 플러쉬는 영속성 컨텍스트의 변경 내용을 데이터베이스에 **동기화**하는 작업인데 이때 등록, 수정, 삭제한 엔티티를 데이터베이스에 반영한다. 

#### 영속성 컨텍스트가 엔티티를 관리하면 좋은 장점

- 1차 캐시, 동일성 보장, 트랜잭션, 변경 감지, 지연 로딩



---

https://doublesprogramming.tistory.com/259

http://wonwoo.ml/index.php/post/997

https://wckhg89.tistory.com/10

엔티티 매니저?

